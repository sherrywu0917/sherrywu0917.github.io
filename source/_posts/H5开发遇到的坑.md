---
title: H5开发踩到的坑

date: 2017-03-16 20:42:41
tags: [总结]
---

### 某些安卓机上tap事件会触发两次

### 某些安卓微信缓存严重，reload事件会失效
#### 解决方法
- location.reload(forcedReload): 当取值为 true 时，将强制浏览器从服务器重新获取当前页面资源，而不是从浏览器的缓存中读取，如果取值为 false 或不传该参数时，浏览器则可能会从缓存中读取当前页面。
- 加时间戳

### ios微信内音乐不能自动播放
微信屏蔽了音乐自动播放，使用微信API：**WeixinJSBridge**，当getNetworkType事件被触发时去播放音乐。
解决方法：
``` javascript
if((/MicroMessenger/ig).test(window.navigator.userAgent) && (typeof WeixinJSBridge != "undefined")) {
    WeixinJSBridge.invoke('getNetworkType', {}, function(e) {
        $('.j-audio')[0].play();
    });
}
```
此外，在手机chrome和safiri中都不支持音乐自动播放，需要用户操作才能触发，基于节省流量的考虑。

<!-- more -->

### ios 客户端内某些样式异常，导致图片没有展示
本质上图片是被覆盖了，应该是z-index的异常

### android软键盘弹出后遮住文本框
解决办法是使用scrollIntoViewIfNeeded()
``` javascript
//通用型
if(/Android [4-6]/.test(navigator.appVersion)) {
    window.addEventListener("resize", function() {
        if(document.activeElement.tagName=="INPUT" || document.activeElement.tagName=="TEXTAREA") {
            window.setTimeout(function() {
                document.activeElement.scrollIntoViewIfNeeded();
            }, 0);
        }
    })
}

//直接针对某个元素
document.getElementById('/*元素id*/').onclick = function(e) {
    setTimeout(() => {
        e.target.scrollIntoViewIfNeeded();
    }, 400);
}
```